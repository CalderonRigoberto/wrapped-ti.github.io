---
const baseUrl = import.meta.env.BASE_URL;

const reviews = [
  {
    rating: 5,
    comment: "Muy práctica para consultar mi información",
    author: "Usuario VISE",
  },
  {
    rating: 5,
    comment: "Fácil de usar y rápida",
    author: "Colaborador",
  },
  {
    rating: 4,
    comment: "Excelente para registrar asistencia",
    author: "Empleado",
  },
];
---

<section class="mobile-app-section" id="mobile-app">
  <div class="mobile-app-bg">
    <div class="gradient-blob cyan blob-app-1"></div>
    <div class="gradient-blob purple blob-app-2"></div>
  </div>

  <div class="container mobile-app-content">
    <!-- Izquierda: Teléfono con perspectiva 3D -->
    <div class="phone-showcase">
      <div class="phone-mockup">
        <div class="phone-frame">
          <!-- Notch -->
          <div class="phone-notch"></div>
          <!-- Screen container -->
          <div class="phone-screen">
            <img
              src={`${baseUrl}images/app-1.png`}
              alt="VISE Móvil - Pantalla de inicio"
              class="screen-image screen-primary"
              loading="lazy"
            />
            <img
              src={`${baseUrl}images/app_2.png`}
              alt="VISE Móvil - Pantalla secundaria"
              class="screen-image screen-secondary"
              loading="lazy"
            />
          </div>
        </div>
        <!-- Sombra dinámica -->
        <div class="phone-shadow"></div>
      </div>
    </div>

    <!-- Derecha: Info + Descarga + Reviews -->
    <div class="app-info">
      <span class="section-label fade-in">APP MÓVIL</span>

      <h2 class="app-title fade-in stagger-1">
        <span class="text-gradient-cyan">VISE</span> Móvil
      </h2>

      <p class="app-description fade-in stagger-2">
        Todo lo que necesitas de VISE en la palma de tu mano. Consulta tu
        información, registra asistencia y mantente conectado desde cualquier
        lugar.
      </p>

      <div class="app-features fade-in stagger-3">
        <div class="feature-item">
          <svg
            class="feature-icon"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
          <span>Registro de asistencia</span>
        </div>
        <div class="feature-item">
          <svg
            class="feature-icon"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
          <span>Consulta de recibos</span>
        </div>
        <div class="feature-item">
          <svg
            class="feature-icon"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
          <span>Notificaciones en tiempo real</span>
        </div>
      </div>

      <div class="download-buttons fade-in stagger-4">
        <a href="#" class="download-btn app-store">
          <svg class="store-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M18.71 19.5C17.88 20.74 17 21.95 15.66 21.97C14.32 22 13.89 21.18 12.37 21.18C10.84 21.18 10.37 21.95 9.1 22C7.79 22.05 6.8 20.68 5.96 19.47C4.25 17 2.94 12.45 4.7 9.39C5.57 7.87 7.13 6.91 8.82 6.88C10.1 6.86 11.32 7.75 12.11 7.75C12.89 7.75 14.37 6.68 15.92 6.84C16.57 6.87 18.39 7.1 19.56 8.82C19.47 8.88 17.39 10.1 17.41 12.63C17.44 15.65 20.06 16.66 20.09 16.67C20.06 16.74 19.67 18.11 18.71 19.5ZM13 3.5C13.73 2.67 14.94 2.04 15.94 2C16.07 3.17 15.6 4.35 14.9 5.19C14.21 6.04 13.07 6.7 11.95 6.61C11.8 5.46 12.36 4.26 13 3.5Z"
            ></path>
          </svg>
          <div class="btn-text">
            <span class="btn-label">Descargar en</span>
            <span class="btn-store">App Store</span>
          </div>
        </a>
        <a href="#" class="download-btn google-play">
          <svg class="store-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M3 20.5V3.5C3 2.91 3.34 2.39 3.84 2.15L13.69 12L3.84 21.85C3.34 21.6 3 21.09 3 20.5ZM16.81 15.12L6.05 21.34L14.54 12.85L16.81 15.12ZM20.16 10.81C20.5 11.08 20.75 11.5 20.75 12C20.75 12.5 20.53 12.9 20.18 13.18L17.89 14.5L15.39 12L17.89 9.5L20.16 10.81ZM6.05 2.66L16.81 8.88L14.54 11.15L6.05 2.66Z"
            ></path>
          </svg>
          <div class="btn-text">
            <span class="btn-label">Disponible en</span>
            <span class="btn-store">Google Play</span>
          </div>
        </a>
      </div>

      <div class="app-reviews fade-in stagger-5">
        <h4 class="reviews-title">Lo que dicen los usuarios</h4>
        <div class="reviews-container">
          {
            reviews.map((review, index) => (
              <div class="review-card" style={`--delay: ${index * 0.1}s`}>
                <div class="review-stars">
                  {[...Array(review.rating)].map(() => (
                    <svg class="star" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                    </svg>
                  ))}
                </div>
                <p class="review-comment">"{review.comment}"</p>
                <span class="review-author">- {review.author}</span>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .mobile-app-section {
    min-height: 100vh;
    position: relative;
    background: var(--color-bg-dark);
    overflow: hidden;
    padding: var(--section-padding) 0;
  }

  .mobile-app-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .blob-app-1 {
    width: 500px;
    height: 500px;
    top: 10%;
    left: -150px;
    opacity: 0.2;
    animation: float-blob 20s ease-in-out infinite;
  }

  .blob-app-2 {
    width: 400px;
    height: 400px;
    bottom: 10%;
    right: -100px;
    opacity: 0.15;
    animation: float-blob 25s ease-in-out infinite reverse;
  }

  @keyframes float-blob {
    0%,
    100% {
      transform: translate(0, 0);
    }
    50% {
      transform: translate(30px, -30px);
    }
  }

  .mobile-app-content {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
  }

  /* ===== PHONE SHOWCASE ===== */
  .phone-showcase {
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1200px;
    padding: 2rem;
  }

  .phone-mockup {
    position: relative;
    transform-style: preserve-3d;
    transform: rotateX(25deg) rotateY(-15deg) rotateZ(5deg);
    transition: transform 0.8s var(--ease-out-expo);
  }

  .phone-mockup.normalized {
    transform: rotateX(0) rotateY(0) rotateZ(0);
  }

  .phone-frame {
    position: relative;
    width: 280px;
    height: 580px;
    background: linear-gradient(145deg, #2a2a2a 0%, #1a1a1a 100%);
    border-radius: 44px;
    padding: 12px;
    box-shadow:
      inset 0 0 0 2px rgba(255, 255, 255, 0.1),
      0 0 0 1px rgba(0, 0, 0, 0.5);
    overflow: hidden;
  }

  .phone-notch {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 28px;
    background: #0a0a0a;
    border-radius: 0 0 16px 16px;
    z-index: 10;
  }

  .phone-notch::before {
    content: "";
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    width: 8px;
    height: 8px;
    background: #1a1a1a;
    border-radius: 50%;
    box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.5);
  }

  .phone-screen {
    position: relative;
    width: 100%;
    height: 100%;
    background: #000;
    border-radius: 36px;
    overflow: hidden;
  }

  .screen-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top;
  }

  .screen-primary {
    z-index: 1;
  }

  .screen-secondary {
    z-index: 2;
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 0.6s ease,
      transform 0.6s ease;
  }

  .screen-secondary.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .phone-shadow {
    position: absolute;
    bottom: -60px;
    left: 50%;
    transform: translateX(-50%) rotateX(80deg);
    width: 200px;
    height: 100px;
    background: radial-gradient(
      ellipse,
      rgba(0, 0, 0, 0.4) 0%,
      transparent 70%
    );
    filter: blur(20px);
    transition: all 0.8s var(--ease-out-expo);
  }

  .phone-mockup.normalized .phone-shadow {
    width: 250px;
    bottom: -40px;
    opacity: 0.6;
  }

  /* ===== APP INFO ===== */
  .app-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .section-label {
    display: inline-block;
    font-family: var(--font-display);
    font-size: 0.875rem;
    font-weight: 600;
    letter-spacing: 0.2em;
    color: var(--color-cyan);
  }

  .app-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    line-height: 1.1;
  }

  .app-description {
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    max-width: 500px;
    line-height: 1.7;
  }

  /* ===== FEATURES ===== */
  .app-features {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin: 0.5rem 0;
  }

  .feature-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--color-text-secondary);
    font-size: 1rem;
  }

  .feature-icon {
    width: 20px;
    height: 20px;
    color: var(--color-cyan);
    flex-shrink: 0;
  }

  /* ===== DOWNLOAD BUTTONS ===== */
  .download-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
  }

  .download-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1.25rem;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    text-decoration: none;
    color: var(--color-text-primary);
    transition: all 0.3s var(--ease-out-expo);
  }

  .download-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .store-icon {
    width: 28px;
    height: 28px;
  }

  .btn-text {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .btn-label {
    font-size: 0.7rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .btn-store {
    font-family: var(--font-display);
    font-size: 1rem;
    font-weight: 600;
  }

  /* ===== REVIEWS ===== */
  .app-reviews {
    margin-top: 1.5rem;
  }

  .reviews-title {
    font-family: var(--font-display);
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text-secondary);
    margin-bottom: 1rem;
  }

  .reviews-container {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .review-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    padding: 1rem;
    opacity: 0;
    transform: translateX(20px);
    animation: slideInReview 0.5s ease forwards;
    animation-delay: var(--delay);
  }

  @keyframes slideInReview {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .review-stars {
    display: flex;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
  }

  .review-stars .star {
    width: 14px;
    height: 14px;
    color: #fbbf24;
  }

  .review-comment {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    font-style: italic;
    margin-bottom: 0.5rem;
  }

  .review-author {
    font-size: 0.8rem;
    color: var(--color-text-muted);
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 968px) {
    .mobile-app-content {
      grid-template-columns: 1fr;
      gap: 3rem;
      text-align: center;
    }

    .phone-showcase {
      order: -1;
    }

    .app-info {
      align-items: center;
    }

    .app-features {
      align-items: center;
    }

    .download-buttons {
      justify-content: center;
      flex-wrap: wrap;
    }

    .reviews-container {
      max-width: 400px;
      margin: 0 auto;
    }
  }

  @media (max-width: 480px) {
    .phone-frame {
      width: 240px;
      height: 500px;
      border-radius: 36px;
    }

    .phone-notch {
      width: 100px;
      height: 24px;
    }

    .phone-screen {
      border-radius: 28px;
    }

    .download-buttons {
      flex-direction: column;
      width: 100%;
      max-width: 280px;
    }

    .download-btn {
      justify-content: center;
    }
  }
</style>

<script>
  import { gsap, ScrollTrigger } from "../scripts/gsap-init";

  document.addEventListener("DOMContentLoaded", () => {
    const phoneMockup = document.querySelector(".phone-mockup");
    const screenSecondary = document.querySelector(".screen-secondary");
    const section = document.querySelector(".mobile-app-section");

    if (phoneMockup && section) {
      // Animación del teléfono: de perspectiva inclinada a vista normal
      gsap.to(phoneMockup, {
        rotateX: 0,
        rotateY: 0,
        rotateZ: 0,
        scrollTrigger: {
          trigger: section,
          start: "top 80%",
          end: "center center",
          scrub: 1,
          onUpdate: (self) => {
            if (self.progress > 0.5) {
              phoneMockup.classList.add("normalized");
            } else {
              phoneMockup.classList.remove("normalized");
            }
          },
        },
      });

      // Segunda captura aparece después de que el teléfono se normaliza
      if (screenSecondary) {
        ScrollTrigger.create({
          trigger: section,
          start: "center 60%",
          onEnter: () => {
            screenSecondary.classList.add("visible");
          },
          onLeaveBack: () => {
            screenSecondary.classList.remove("visible");
          },
        });
      }
    }

    // Animación de entrada para los elementos de info
    const infoElements = document.querySelectorAll(".app-info .fade-in");
    if (infoElements.length > 0) {
      gsap.fromTo(
        infoElements,
        { opacity: 0, y: 30 },
        {
          opacity: 1,
          y: 0,
          duration: 0.8,
          stagger: 0.1,
          ease: "power3.out",
          scrollTrigger: {
            trigger: ".app-info",
            start: "top 80%",
            toggleActions: "play none none none",
          },
        }
      );
    }
  });
</script>
